# ACME, http-01, dns-01 — Шпаргалка

## ACME
**ACME (Automatic Certificate Management Environment)** — это протокол, используемый для автоматической выдачи и управления TLS/SSL-сертификатами (например, Let's Encrypt).  
Цель — убрать ручные шаги при получении/обновлении сертификатов.

- Управление ключами и сертификатами автоматизировано.
- Используется для подтверждения владения доменом.
- Поддерживается многими CA (Certificate Authorities), но чаще всего ассоциируется с Let's Encrypt.

---

## Challenge types (проверка владения доменом)

ACME использует **челленджи** (задачи) для проверки, что вы контролируете домен.  
Самые популярные:

### 1. http-01
- Суть: CA делает HTTP-запрос к вашему домену.
- Как работает:
    1. ACME-клиент (например, certbot) создаёт специальный токен.
    2. Токен выкладывается в `http://<домен>/.well-known/acme-challenge/<token>`.
    3. Let's Encrypt делает GET-запрос на этот URL.
    4. Если содержимое совпадает с ожидаемым — подтверждение пройдено.
- Требования:
    - Сервер должен быть доступен по **80 порту**.
    - Домен должен указывать на ваш сервер (A/AAAA-запись).
- Ограничения:
    - Работает только для публично доступных серверов.
    - Неудобно для wildcard-сертификатов (`*.example.com`).

### 2. dns-01
- Суть: подтверждение через DNS.
- Как работает:
    1. ACME-клиент создаёт TXT-запись в DNS вида  
       `_acme-challenge.<домен> = <token>`.
    2. Let's Encrypt делает DNS-запрос и проверяет запись.
- Преимущества:
    - Работает **для wildcard-сертификатов**.
    - Не требует, чтобы сервер был доступен по HTTP.
- Минусы:
    - Требуется доступ к DNS-провайдеру для автоматизации (API).
    - Может быть сложнее в настройке.

---

## Другие типы челленджей (менее распространённые)
- **tls-alpn-01**  
  Проверка через TLS-расширение ALPN (Application-Layer Protocol Negotiation).  
  Требует поднять сервер на 443 порту и вернуть специальный сертификат.  
  Используется реже, в специфичных сценариях.

---

## Практическое сравнение

| Challenge     | Где используется               | Плюсы                              | Минусы                           |
|---------------|-------------------------------|-------------------------------------|----------------------------------|
| **http-01**   | Простые сайты                 | Легко автоматизировать, простая настройка | Нужен доступ по 80 порту, нет wildcard |
| **dns-01**    | Wildcard, сложные сценарии    | Поддержка `*.домен`, не нужен веб-сервер | Требуется доступ к DNS API       |
| **tls-alpn-01** | Специфичные случаи (reverse proxy, контейнеры) | Работает через 443 порт | Более сложная настройка          |

---

## ACME-клиенты
- **certbot** (классический, поддерживает http-01, dns-01, tls-alpn-01).
- **acme.sh** (легковесный, bash).
- **lego** (Go).
- Интеграции в Kubernetes (cert-manager).

---

## Итог
- **ACME** — протокол автоматизации SSL/TLS.
- **http-01** — подтверждение через HTTP, просто, но без wildcard.
- **dns-01** — подтверждение через DNS, поддерживает wildcard, но сложнее в автоматизации.
- **tls-alpn-01** — через TLS ALPN, редкий случай.
